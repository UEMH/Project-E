<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UEMH_HP</title>
    <link rel="icon" type="image/x-icon" href="/images/cat.ico">
    <style>
        /* æ‰€æœ‰åŸæœ‰çš„CSSæ ·å¼ä¿æŒä¸å˜ */
        /* åªæ·»åŠ ç¦»çº¿çŠ¶æ€æŒ‡ç¤ºå™¨æ ·å¼ */
        
        .offline-indicator {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 1000;
            background: rgba(255, 165, 0, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            backdrop-filter: blur(5px);
        }
        
        .user-info {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            backdrop-filter: blur(5px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* å…¶ä½™CSSæ ·å¼ä¿æŒä¸å˜ */
        /* ... åŸæœ‰çš„æ‰€æœ‰CSSæ ·å¼ ... */
    </style>
</head>
<body>
    <!-- ç¦»çº¿çŠ¶æ€æŒ‡ç¤ºå™¨ -->
    <% if (!dbConnected) { %>
        <div class="offline-indicator">
            âš ï¸ ç¦»çº¿æ¨¡å¼
        </div>
    <% } %>

    <!-- ç”¨æˆ·ä¿¡æ¯æ  -->
    <div class="user-info">
        <% if (user) { %>
            <span>æ¬¢è¿, <%= user.username %></span>
            <% if (user.id === 'offline-admin') { %>
                <span style="color: #ffa500; margin-left: 5px;">(ç¦»çº¿)</span>
            <% } %>
            <form action="/logout" method="POST" style="display: inline;">
                <button type="submit" class="auth-btn">ç™»å‡º</button>
            </form>
        <% } else { %>
            <a href="/login" class="auth-btn">ç™»å½•</a>
        <% } %>
    </div>

    <!-- å›ºå®šåœ¨é¡¶éƒ¨çš„ä¹¦ç­¾æ  -->
    <div class="top-bookmarks" id="topBookmarks">
        <div class="bookmarks-container">
            <div class="bookmarks-bar" id="bookmarksBar">
                <!-- ä¹¦ç­¾å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div class="bookmarks-header-buttons">
                <button class="header-btn" id="importBookmarks" title="å¯¼å…¥æ”¶è—å¤¹">ğŸš©</button>
                <button class="header-btn <%= !user && 'disabled-btn' %>" id="changeWallpaper" title="æ›´æ”¹å£çº¸" <%= !user && 'disabled' %>>ğŸ–¼ï¸</button>
                <button class="header-btn" id="helpBtn" title="ä½¿ç”¨è¯´æ˜">â“</button>
                <button class="header-btn" id="collapseBtn" title="æ”¶èµ·æ”¶è—å¤¾">â–²</button>
            </div>
        </div>
    </div>

    <!-- æ”¶è—å¤¹æ”¶èµ·æ—¶çš„å±•å¼€æŒ‰é’® -->
    <button class="expand-bookmarks" id="expandBookmarks" title="å±•é–‹æ”¶è—å¤¾">â–¼</button>

    <div class="background-container">
        <div class="bg-image" id="bgImage"></div>
        <div class="loading" id="loading">åœ–ç‰‡åŠ è¼‰ä¸­...</div>
        <div class="error-message" id="errorMessage">
            <h2>ç„¡æ³•åŠ è¼‰èƒŒæ™¯åœ–ç‰‡</h2>
            <p>è«‹æª¢æŸ¥åœ–ç‰‡è·¯å¾‘æ˜¯å¦æ­£ç¢º</p>
        </div>
    </div>
    
    <div class="content" id="content">
        <h1> </h1>
        <p> </p>
    </div>
    
    <!-- å³é”®èœå• -->
    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" id="addBookmark">æ·»åŠ æ–°æ”¶è—</div>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item" id="editBookmark">ç¼–è¾‘æ”¶è—</div>
        <div class="context-menu-item" id="deleteBookmark">åˆ é™¤æ”¶è—</div>
    </div>
    
    <!-- æ·»åŠ /ç¼–è¾‘æ”¶è—é¡¹çš„æ¨¡æ€æ¡† -->
    <div class="modal" id="bookmarkModal">
        <div class="modal-content">
            <h2 id="modalTitle">æ·»åŠ æ”¶è—</h2>
            <div class="form-group">
                <label for="bookmarkName">åç§° (å¯é€‰)</label>
                <input type="text" id="bookmarkName" placeholder="è¾“å…¥æ”¶è—åç§° (ç•™ç©ºåˆ™ä»…æ˜¾ç¤ºå›¾æ ‡)">
            </div>
            <div class="form-group">
                <label for="bookmarkUrl">ç½‘å€</label>
                <input type="text" id="bookmarkUrl" placeholder="https://example.com">
            </div>
            <div class="form-group">
                <label for="bookmarkIcon">å›¾æ ‡ (å¯é€‰ - è¾“å…¥å›¾ç‰‡URLæˆ–è¡¨æƒ…ç¬¦å·)</label>
                <input type="text" id="bookmarkIcon" placeholder="è¾“å…¥å›¾ç‰‡URLæˆ–è¡¨æƒ…ç¬¦å·">
                <div class="icon-preview" id="iconPreview"></div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" id="cancelBookmark">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="saveBookmark">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- æ›´æ”¹å£çº¸æ¨¡æ€æ¡† -->
    <div class="modal" id="wallpaperModal">
        <div class="modal-content">
            <h2>æ›´æ”¹å£çº¸</h2>
            <div class="form-group">
                <label for="wallpaperFile">é€‰æ‹©å£çº¸å›¾ç‰‡</label>
                <input type="file" id="wallpaperFile" accept="image/*">
                <div class="wallpaper-preview" id="wallpaperPreview">
                    <img id="wallpaperPreviewImg" src="" alt="å£çº¸é¢„è§ˆ">
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" id="cancelWallpaper">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="saveWallpaper">ç¡®å®šæ›´æ¢</button>
            </div>
        </div>
    </div>

    <!-- å¸®åŠ©è¯´æ˜æ¨¡æ€æ¡† -->
    <div class="modal" id="helpModal">
        <div class="modal-content">
            <div class="help-content">
                <h2>æ­¡è¿ä½¿ç”¨ä¸»é </h2>
                <p>é€™æ˜¯ä¸€å€‹ç°¡æ½”ç¾è§€çš„ç€è¦½å™¨èµ·å§‹é ï¼Œæ”¶è—å¤¾å›ºå®šåœ¨é ‚éƒ¨æ–¹ä¾¿è¨ªå•</p>
                
                <h3>ä½¿ç”¨èªªæ˜</h3>
                <ul>
                    <li>å·¦é”®ç‚¹å‡» - è®¿é—®ç½‘ç«™</li>
                    <li>å·¦é”®æ‹–æ‹½ - é‡æ–°æ’åºæ”¶è—é¡¹</li>
                    <li>å³é”®ç‚¹å‡»æ”¶è—é¡¹ - ç¼–è¾‘æˆ–åˆ é™¤</li>
                    <li>å³é”®ç‚¹å‡»ç©ºç™½åŒºåŸŸ - æ·»åŠ æ–°æ”¶è—é¡¹</li>
                    <li>æ‰€æœ‰æ›´æ”¹ä¼šè‡ªåŠ¨ä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ä¸­</li>
                    <li>æ”¶è—é¡¹å¯ä»¥ä»…æ˜¾ç¤ºå›¾æ ‡ï¼Œæ— éœ€åç§°</li>
                    <li>æ·»åŠ ä¹¦ç­¾æ—¶å¦‚æœä¸æä¾›å›¾æ ‡ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°è¯•è·å–ç½‘ç«™å›¾æ ‡</li>
                    <% if (user) { %>
                        <li>å½“å‰ç”¨æˆ·: <strong><%= user.username %></strong></li>
                    <% } else { %>
                        <li><a href="/login" style="color: #4FC3F7;">ç‚¹å‡»ç™»å½•</a>ä»¥ä½¿ç”¨æ›´æ”¹å£çº¸åŠŸèƒ½</li>
                    <% } %>
                    <% if (!dbConnected) { %>
                        <li style="color: #ffa500;">âš ï¸ å½“å‰è¿è¡Œåœ¨ç¦»çº¿æ¨¡å¼</li>
                    <% } %>
                </ul>
                
                <h3>é»˜è®¤è´¦å·</h3>
                <p>ç”¨æˆ·å: <strong>UEMH-CHAN</strong><br>å¯†ç : <strong>041018</strong></p>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-primary" id="closeHelp">å…³é—­</button>
            </div>
        </div>
    </div>

    <!-- è°ƒè¯•ä¿¡æ¯å®¹å™¨ -->
    <div class="debug-container" id="debugContainer">
        <div class="debug-header" id="debugHeader">
            <div class="debug-title">è°ƒè¯•ä¿¡æ¯</div>
            <div class="debug-controls">
                <button class="debug-toggle" id="debugToggle">âˆ’</button>
                <button class="debug-toggle" id="debugHide">Ã—</button>
            </div>
        </div>
        <div class="debug-info" id="debugInfo"></div>
        <div class="debug-slider-container">
            <span>é€æ˜åº¦:</span>
            <input type="range" min="0" max="100" value="70" class="debug-slider" id="debugOpacity">
        </div>
    </div>

    <script>
        // åˆå§‹æ”¶è—é¡¹æ•°æ®
        const defaultBookmarks = [
            { id: 1, name: "Google", url: "https://www.google.com", icon: "https://favicon.pub/google.com" },
            { id: 2, name: "YouTube", url: "https://www.youtube.com", icon: "https://favicon.pub/youtube.com" },
            { id: 3, name: "GitHub", url: "https://github.com", icon: "https://favicon.pub/github.com" },
            { id: 4, name: "", url: "https://homdgcat.wiki/sr/char?lang=CH", icon: "https://favicon.is/homdgcat.wiki" },
            { id: 5, name: "è¡¨æƒ…ç¬¦å·", url: "https://example.com", icon: "ğŸ”" }
        ];

        // DOMå…ƒç´ 
        let topBookmarks, bookmarksBar, contextMenu, bookmarkModal, helpModal, wallpaperModal;
        let modalTitle, bookmarkName, bookmarkUrl, bookmarkIcon, iconPreview;
        let saveBookmarkBtn, cancelBookmarkBtn, addBookmarkBtn, editBookmarkBtn, deleteBookmarkBtn;
        let importBookmarksBtn, helpBtn, collapseBtn, expandBookmarks, content, closeHelp;
        let changeWallpaperBtn, wallpaperFile, wallpaperPreview, cancelWallpaperBtn, saveWallpaperBtn;
        let debugContainer, debugInfo, debugToggle, debugHide, debugOpacity, debugHeader;

        // å…¨å±€å˜é‡
        let bookmarks = [];
        let currentBookmarkId = null;
        let isEditing = false;
        let isDebugCollapsed = false;
        let isDebugHidden = false;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            debug('DOMåŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–');
            
            // åˆå§‹åŒ–DOMå…ƒç´ 
            initDOMElements();
            
            // åŠ è½½æ”¶è—é¡¹
            loadBookmarks();
            renderBookmarks();
            setupEventListeners();
            loadCollapseState();
            setupDebugControls();
            
            // å›¾ç‰‡åŠ è½½å¤„ç†
            const loading = document.getElementById('loading');
            const bgImage = document.getElementById('bgImage');
            const errorMessage = document.getElementById('errorMessage');
            
            // åˆ›å»ºæµ‹è¯•å›¾ç‰‡ä»¥æ£€æŸ¥æ˜¯å¦å¯åŠ è½½
            const testImage = new Image();
            testImage.onload = function() {
                loading.style.display = 'none';
                bgImage.style.opacity = '1';
                debug('èƒŒæ™¯å›¾ç‰‡åŠ è½½æˆåŠŸ');
            };
            
            testImage.onerror = function() {
                loading.style.display = 'none';
                errorMessage.style.display = 'block';
                debug('èƒŒæ™¯å›¾ç‰‡åŠ è½½å¤±è´¥');
            };
            
            // ä½¿ç”¨é»˜è®¤èƒŒæ™¯å›¾ç‰‡
            testImage.src = '/images/Night_copy.jpg';
        });

        // å…¶ä½™JavaScriptä»£ç ä¿æŒä¸å˜...
        // ... ä¿æŒåŸæœ‰çš„æ‰€æœ‰JavaScriptåŠŸèƒ½ä»£ç 

        // è°ƒè¯•å‡½æ•°
        function debug(message) {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${message}</div>`;
            debugInfo.scrollTop = debugInfo.scrollHeight;
            console.log(message);
        }
    </script>
</body>
</html>
